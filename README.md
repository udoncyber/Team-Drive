=== การใช้ Google Service Account ทะลุโควต้า 750GB ===
.
ขอบคุณพี่เสก ที่เริ่มต้นแบ่งปันจุดประกาย เริ่มถ่ายทอดวิชานี้ให้ และเพื่อนๆพี่ๆ อีกหลายท่านที่ช่วยแบ่งปันความรู้เรื่อง Rclone ให้พวกเราได้นำไปประยุกต์ใช้งาน 
และเพื่อการศึกษาร่วมกันครับ ผมแปะบทความที่เกี่ยวข้องไว้ท้ายโพสต์นะครับ สามารถไปศึกษาเพิ่มเติมได้เลยครับ
.
*** PART 0 : ปูพื้นฐานและคำนวณจำนวน SA ที่ต้องใช้
- SA = Service Account = บัญชีบริการ
.

Q: การใช้ SA เพิ่มความสะดวกยังไง
A: ไม่จำเป็นต้องสมัคร Gmail เยอะๆเพื่อมาใช้โคลนไดรว์
.

Q: การใช้ SA หลายๆตัว เหมือนหรือต่างจากใช้ Gmail อย่างไร
A: 1 SA กับ 1 Gmail Account มีโควต้าในการโคลน 750GB ต่อวันเหมือนกัน
.

SA ถูกสร้างมาจาก Gmail Account เพื่อทำใช้ในการทำงานที่ปริมาณเยอะๆ
1 Gmail Account สามารถสร้างได้หลาย SA
.

Q: ใช้ Google Group มาช่วยในการจัดการยังไง
A: โดยการเพิ่มเมลเข้า Google Group แล้วเอา Google Group ไปเพิ่มใน Team Drive อีกที ทำหนเดียวไม่ต้องมานั่งเพิ่มเมลทีละเมลทุกครั้งไป เวลาจะย้ายก็ย้ายไปทั้ง Group จึงง่ายและสะดวกในการจัดการมากกว่า
.

Q: การใช้ SA ทำให้ทะลุโควต้า 750GB ได้ยังไง
A: ใช้ SA หลายๆตัวช่วยกัน ตัวละ 750GB หลายๆตัวก็คูณจำนวนตัวไป
.

การคำนวณ SA ที่ต้องใช้ = ขนาดข้อมูลทั้งหมด*(ในหน่วย GB) / 750

วิธีการแปลงหน่วยคล่าวๆ 1TB = 1000GB (ขนาดจริง 1 TB = 1024GB)

สมมุติว่าเรามีข้อมูลที่ต้องการโคลนทั้งหมด 10TB

ดังนั้นต้องใช้ SA ทั้งหมดจำนวน (10*1000) / 750 = 13.3333 ตัว

ได้เศษเท่าไหร่ให้ปัดขึ้นให้หมด (มีเหลือไว้ดีกว่าขาด)

จึงได้จำนวน SA ขั้นต่ำที่ต้องใช้ คือ 14 ตัว (จะใช้มากกว่านี้ก็ได้)
.
** หมายเหตุ ** หากไม่ทราบขนาดข้อมูลทั้งหมดให้ใช้คำสั่ง rclone size ชื่อรีโมท: ในการเช็ค 

(อย่าลืมสร้าง access_token ให้กับ remote ก่อน หรือก๊อปของตัวอื่นมาใช้ ให้ไปแก้ไขที่ไฟล์ rclone.conf)

หรือหากไม่ถนัดก็สามารถไปโหลดโปรแกรม rclone browser มาใช้เช็คขนาดแทนได้

หาโหลดได้จาก http://martins.ninja/RcloneBrowser/
.

ว่าด้วยเรื่องของสิทธิ์ในการใช้งาน Team Drive (Shared Drive) ตั้งค่าให้เหมาะกับการใช้งาน

- Manager (ผู้จัดการ) : จัดการเนื้อหา/สมาชิก/แก้ไขการตั้งค่าต่างๆได้
- Content Manager (ผู้จัดการเนื้อหา) : เพิ่ม, แก้ไข, ย้าย และ ลบไฟล์ได้
- Contributor : เพิ่มและแก้ไขไฟล์ได้
- Commenter : สามารถแสดงความคิดเห็นได้
- Viewer : ดูได้อย่างเดียว
.

*** PART 1 : สร้าง GOOGLE GROUP เตรียมไว้

1. ไปที่ https://groups.google.com/
2. คลิกที่ปุ่ม "สร้างกลุ่ม"
3. ใส่รายละเอียดตามที่เราต้องการ และกำหนดสิทธิ์
4. คลิกที่ปุ่ม "สร้าง"
5. ยืนยันว่าไม่ใช่หุ่นยนต์
.

*** PART 2 : สร้าง GOOGLE PROJECT ใหม่ และ เปิดใช้งาน GOOGLE DRIVE API
.

1. ไปที่ https://console.cloud.google.com/
2. คลิกที่ "เลือกโปรเจค"
3. คลิกที่ "โปรเจคใหม่" มุมบนขวา
4. ใส่ชื่อโปรเจค แล้วคลิกที่ปุ่ม "สร้าง"
5. ในช่อง "ค้นหา API และบริการ" ให้ใส่คีย์เวิร์ดลงไปว่า "google drive"
6. คลิกเลือกที่ Google Drive API
7. คลิกที่ปุ่ม "เปิดใช้"
8. คลิกที่ "สร้างข้อมูลเข้าสู่ระบบ" มุมบนขวา
9. คลิกที่ "ข้อมูลรับรอง" เมนูด้านซ้าย เลือกตามนี้
- คุณกำลังใช้ API ตัวใด ให้เลือกเป็น "Google Drive API"
- คุณจะเรียกใช้ API ได้จากที่ใด ให้เลือกเป็น "แบบที่ไม่ใช้ อื่นๆ (เช่น cron job, daemon)"
- คุณต้องการเข้าถึงข้อมูลใด ให้เลือกเป็น "ข้อมูลแอปพลิเคชั่น"
- คุณกำลังวางแผนที่จะใช้ API กับ App Engine หรือ Compute Engine ใช่ไหม ให้เลือกเป็น "ใช่ฉันใช้หนึ่งหรือทั้งสองรายการ"
10. คลิกที่ปุ่มเสร็จสิ้น
11. คลิกที่ "หน้าจอคำยินยอม OAuth" เมนูด้านซ้าย User Type เลือกเป็น "ภายนอก"
12. คลิกที่ปุ่มสร้าง
13. ตั้งชื่อแอปพลิเคชั่นเป็นชื่ออะไรก็ได้(แล้วแต่เรา)
14. คลิกปุ่มบันทึก
.

*** PART 3 : สร้าง SERVICE ACCOUNT (บัญชีบริการ)
.

1. คลิกที่เมนูนำทาง (ขีดสามขีดแนวนอน) ที่อยู่ทางซ้ายบน
2. จะปรากฏเมนูขึ้นมา ให้เลือกไปที่ "IAM และผู้ดูแลระบบ --> บัญชีบริการ"
3. คลิกที่ปุ่ม "สร้างบัญชีบริการ" ตรงด้านบน
4. ใส่ชื่อบัญชีบริการ แล้วคลิกสร้าง
5. คลิกต่อไป
6. คลิก "สร้างคีย์"
7. จะปรากฎหน้าต่าง popup ขึ้นมาทางด้านขวา เลือกประเภทคีย์เป็น JSON คลิก "สร้าง"
8. คีย์จะถูกดาวน์โหลดบันทึกลงเครื่องเราโดยอัตโนมัติ คลิกปิด
9. ในช่อง "คีย์" จะปรากฎรหัสคีย์ คลิกเสร็จสิ้น
10. หน้าต่างจะถูกปิดและกลับมาสู่ หน้าแสดงบัญชีบริการ (SA) ที่มีอยู่ทั้งหมด
ซึ่งจะปรากฏในรูปแบบ "ชื่อบัญชีบริการ @ รหัสโปรเจค .iam .gserviceaccount .com/"
เราจะนำบัญชีบริการนี้ไปใช้แทนอีเมล ซึ่งหนึ่งบัญชีก็จะมีโควต้าบัญชีละ 750 GB ลดปัญหาไม่ต้องสร้างเมลซ้ำๆเยอะๆหลายๆเมล
11. ทำซ้ำในขั้นตอนที่ 3-10 ไปจนครบจำนวน SA ที่เราต้องการในตอนแรกจากที่คำนวณมา
(1 โปรเจคสร้างได้ สูงสุด 100 SA ถ้าไม่พอให้สร้างโปรเจคเพิ่ม สมมุติมี 100 SA ก็จะได้โควต้า 100*750 =75000 GB หรือราวๆ 75 TB)
12. ก๊อปชื่อบัญชีบริการที่ประกอบด้วยเครื่องหมาย @ ไปจัดเก็บเพื่อเตรียมนำไปใช้งาน

แนะนำให้ใช้ Google Spreadsheet ( https://docs.google.com/spreadsheets/ ) ช่วยในการจัดการข้อมูล ได้ง่ายขึ้น สะดวกในการจัดเก็บ และนำไปใช้งาน หรือท่านใดถนัดอย่างอื่นก็สามารถเลือกได้ตามความถนัด
.

*** PART 4 : นำคีย์ของ SERVICE ACOUNT ที่โหลดไว้เป็น JSON มาเตรียมเพื่อใช้งาน
.

1. ไปที่โฟลเดอร์ที่ JSON ไฟล์ได้ถูกดาวน์โหลดเก็บไว้
2. เปลี่ยนชื่อไฟล์ใหม่ โดยให้เรียงลำดับกันไป 1.json, 2.json, 3.json, ... ไปเรื่อยๆจนครบทุกตัว
3. ไปที่โฟลเดอร์ที่เก็บ rclone.exe ไว้ สร้างโฟลเดอร์ใหม่ชื่อว่า json
4. ย้ายไฟล์ .json ทั้งหมดที่ถูกเปลี่ยนชื่อแล้วไปไว้ในโฟลเดอร์ที่สร้างมา
.

*** PART 5 : นำ SERVICE ACCOUNT มาเพิ่มลงใน GOOGLE GROUP
.

1. กลับไปที่ Google Group ที่สร้างไว้ใน Part1 คลิกที่ “กลุ่มของฉัน” ในเมนูด้านซ้ายมือ
3. กดเข้าไปในกลุ่มที่เราได้สร้างไว้
4. หาคำว่า "จัดการสมาชิก" บริเวณด้านขวาล่าง แล้วคลิก
5. เมนูด้านซ้าย ให้คลิกที่ "สมาชิก" เพื่อให้แสดงเมนูย่อย แล้วเลือก "เพิ่มสมาชิกโดยตรง"
6. ให้ copy รายการ SA จาก Google Spreadsheet ที่ได้จัดเก็บไว้ในคอลัมน์แนวตั้ง มาทีละ 10 รายการ (googlegroups จะอนุญาตให้เพิ่มได้ครั้งละ 10 เท่านั้น จำกัดไม่เกิน 100 ต่อ 24 ชม.) หากต้องการเพิ่มอีกให้รอไปอีก 24 ชม.
7. กลับมาที่ Googlegroups นำมาวางในช่อง “ป้อนที่อยู่อีเมลที่จะเพิ่มเป็นสมาชิก”
8. ส่วน “ข้อความต้อนรับ” ให้ใส่อะไรไปตามเราต้องการได้เลย
9. ส่วน “ตัวเลือกการสมัครรับอีเมล” ให้เลือกเป็น “ไม่ใช้อีเมล”
10. คลิก “เพิ่ม”
11. ยืนยันว่าไม่ใช่หุ่นยนต์
12. เมื่อเพิ่ม 10 SA เสร็จ มันจะขึ้นแจ้งว่าถูกเพิ่มไปแล้ว 10 ให้กด “เพิ่มอีก”
13. ทำซ้ำข้อที่ 6,7,9,10,11,12 จนครบทุก SA ที่ได้สร้างมา
14. คลิกที่ “เสร็จ”
.

*** PART 6 : เพิ่ม GOOGLEGROUPS เข้าทีมไดรว์
.

ให้นำ เมลกลุ่ม@googlegroups.com ไปเพิ่มในทีมไดรว์
โดยกำหนดสิทธิ์ดังนี้
- ต้นทาง ให้สิทธิ์ขั้นต่ำเป็น Viewer
- ปลายทางให้ขั้นต่ำเป็น Content Manager
.

*** PART 7 : การใช้งานคำสั่ง RCLONE
.

1. เปิด Notepad พิมพ์คำสั่งข้างล่างนี้ลงไป
2. ให้ Save As .. เป็น ชื่อไฟล์ .cmd หรือ .bat ไว้ที่โฟลเดอร์เดียวกับที่เก็บ rclone.exe ไว้
3. ลองดับเบิ้ลคลิกที่ไฟล์เพื่อลองทดสอบการทำงานของสคริปต์ดังกล่าวดู
.

เอกสารอ้างอิงการใช้งานคำสั่ง
https://docs.google.com/…/1OWZwe1jylY8A4PamtSih4XHfibYDHMah…
.

รูปแบบที่ 1 การเขียนคำสั่งแบบตรงๆทื่อๆ
มี josn กี่ตัว ก็เพิ่มคำสั่งลงไป จะยกตัวอย่างว่ามี 5 ตัวก่อน เขียนโค้ดดังนี้

rclone sync "ชื่อรีโมทต้นทาง:" "ชื่อรีโมทปลายทาง:" -v --drive-server-side-across-configs=true --transfers=3 --fast-list --size-only --max-transfer 500G --drive-service-account-file=json\1.json

rclone sync "ชื่อรีโมทต้นทาง:" "ชื่อรีโมทปลายทาง:" -v --drive-server-side-across-configs=true --transfers=3 --fast-list --size-only --max-transfer 500G --drive-service-account-file=json\2.json

rclone sync "ชื่อรีโมทต้นทาง:" "ชื่อรีโมทปลายทาง:" -v --drive-server-side-across-configs=true --transfers=3 --fast-list --size-only --max-transfer 500G --drive-service-account-file=json\3.json

rclone sync "ชื่อรีโมทต้นทาง:" "ชื่อรีโมทปลายทาง:" -v --drive-server-side-across-configs=true --transfers=3 --fast-list --size-only --max-transfer 500G --drive-service-account-file=json\4.json

rclone sync "ชื่อรีโมทต้นทาง:" "ชื่อรีโมทปลายทาง:" -v --drive-server-side-across-configs=true --transfers=3 --fast-list --size-only --max-transfer 500G --drive-service-account-file=json\5.json

pasue

รูปแบบที่ 2 โดยการใช้ Loop ช่วย
วิธีนี้จะช่วยลดความซับซ้อนในการเขียนสคริปต์ลงไปได้เยอะ เขียนโค้ดดังนี้

@echo off setlocal enabledelayedexpansion
set source="ชื่อรีโมทต้นทาง:ชื่อโฟลเดอร์"
set destination="ชื่อรีโมทปลายทาง:ชื่อโฟลเดอร์"
set folderjson="json" set count=จำนวนSAที่ใช้ทั้งหมด

:loop
set start=1

for /L %%i in (%start%, 1, %count%) do (
rclone sync %source% %destination% --drive-service-account-file=%folderjson%\%%i.json -v --drive-server-side-across-configs=true --fast-list --size-only --transfers=3 --max-transfer=500G
)
rclone dedupe --dedupe-mode newest %destination% --drive-service-account-file=%folderjson%\%%i.json

goto loop
.

[บทความที่เกี่ยวข้อง]
ฉบับวิดีโอให้ไปดูของพี่หยกได้เลยครับ
https://www.facebook.com/groups/496091650599802/permalink/1283051271903832/
AutoRclone เวอร์ชั่น xyou365 ให้ไปอ่านของพี่ฝนได้เลยครับ
https://www.facebook.com/groups/496091650599802/permalink/1283465755195717/
บทความแนะนำ AutoRclone เวอร์ชั่น xyou365 จากพี่ ดูหนัง Unlimited
https://www.facebook.com/groups/496091650599802/permalink/1285993691609590/
.

หากบทความนี้มีข้อผิดพลาดหรือตกหล่นตรงไหนรบกวน แจ้งมาเลยนะครับ เดี๋ยวผมจะรีบแก้ไขให้ครับ จะได้เป็นประโยชน์ให้เพื่อนๆได้ความรู้แบบที่ถูกต้องไปด้วยครับ ใช้เป็นแนวทางในการศึกษาร่วมกันครับ
.

ติดตามบทความได้ที่ Fanpage : Bombx TV
https://www.facebook.com/bombx.tv
ช่อง YouTube https://www.youtube.com/channel/UCukh0lqzWALDbxbv9eGKcbQ
ในภาพอาจจะมี ข้อความ
